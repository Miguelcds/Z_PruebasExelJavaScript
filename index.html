<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asignador de Zonas de Bilbao</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            color: aliceblue;
            background-color: black;
            background-image: url("bilbo.jpg");
            /*background-size: cover;*/
            background-repeat: no-repeat;
            /*position: relative;*/
        }

        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Oscurece la imagen con un color negro semitransparente */
            z-index: -1; /* Asegura que la capa esté detrás del contenido */
        }

        h1{
            padding-top: 100px;
            text-align: center;
        }
        .upload-container {
            margin-top: 150px;
            border: 5px dashed #ff0000;
            padding: 40px;
            padding-bottom: 60px;
            text-align: center;
            margin-bottom: 20px;
        }
        button {
            background-color: #4CAF50;
            color: rgb(0, 0, 0);
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;

        }
        button:disabled {
            background-color: #ff0000;
        }
        #results {
            margin-top: 0px;
        }

        @media (max-width: 500px ) {

            h1{
                margin-top: 20px;
                padding-top: 10px;
            }

            .upload-container{
                display: flex;
                flex-direction: column;
                margin-top: 50px;
                border: none;

            }
    
        }

    </style>
</head>
<body>
    <h1>Asignador de Zonas de Bilbao</h1>
    
    <div class="upload-container">
        <p>Selecciona tu archivo Excel (.xlsx) con las calles:</p>
        <input type="file" id="fileInput" accept=".xlsx, .xls" />
        <button id="processBtn" disabled>Procesar Archivo</button>
        <button id="downloadBtn" disabled>Descargar Resultado</button>
    </div>
    
    <div id="results"></div>

    <!-- SheetJS (xlsx) para manejar Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    
    <script>
        // Diccionario completo de zonas (ejemplo)
        const zonasEstandar = {

                //  DEUSTO: 

                "ANDALUCÍA": "Deusto",
                "ARAGÓN": "Deusto",
                "ASTURIAS": "Deusto",
                "AV LEHENDAKARI AGUIR": "Deusto o San Ignacio *Verficacion pdnt*",
                "AV MADARIAGA": "Deusto",
                "AV RAMÓN Y CAJAL": "Deusto",
                "BADAJOZ": "Deusto",
                "BENITA ASAS": "Deusto",
                "BLAS DE OTERO": "Deusto",
                "BURGOS": "Deusto",
                "CACERES": "Deusto",
                "CANTABRIA": "Deusto",
                "EGUZKILORE": "Deusto",
                "ENEKURI": "Deusto",
                "EXTREMADURA": "Deusto",
                "FRANCESC MACIA": "Deusto",
                "GALICIA": "Deusto",
                "GREGORIO BALPARDA": "Deusto",
                "HELIODORO DE LA TORRE": "Deusto",
                "IBAREKOLANDA": "Deusto",
                "ITURRIKOETXE": "Deusto",
                "JON ARROSPIDE": "Deusto",
                "JUAN DE URBIETA": "Deusto",
                "JULIO LAZURTEGUI": "Deusto",
                "JULIO URQUIJO": "Deusto",
                "LA RIOJA": "Deusto",
                "LAGUNETXEA": "Deusto",
                "LOGROÑO": "Deusto",
                "LUIS POWER": "Deusto",
                "LUZARRA": "Deusto",
                "MATXINTXU": "Deusto",
                "CA MORGAN": "Deusto",
                "NAVARRA": "Deusto",
                "PL PLACIDO CAREAGA": "Deusto",
                "RAFAELA YBARRA": "Deusto",
                "RIBERA DE BOTICA VIEJA": "Deusto",
                "SAGRADA FAMILIA": "Deusto",
                "PL SAN PEDRO": "Deusto",
                "PL SAN PIO X": "Deusto",
            
                // RI DEUSTO:

                "RI DEUSTU": "Deusto Muelle",
                //"": "Deusto Muelle",
                //"": "Deusto Muelle",
                //"": "Deusto Muelle",
                
                // DEUSTO MONTE:

                "GORBEIA": "Deusto Monte",
                "MONTE GANEKOGORTA": "Deusto Monte",
                //"": "Deusto Monte",
                //"": "Deusto Monte",
                //"": "Deusto Monte",


                //  SAN IGNACIO:

                "ANDALUCIA": "San Ignacio",
                "ARTURO CAMPION": "San Ignacio",
                "AV TXOMIN GARAT": "San Ignacio",
                "AV ZUMALAKARREGI": "San Ignacio",
                "BENIDORM": "San Ignacio",
                "ELORRIETA": "San Ignacio",
                "ETXENAGUSIA": "San Ignacio",
                "ERDIKOETXE":"San Ignacio",
                "ISLAS CANARIAS": "San Ignacio",
                "NAVARRO VILLOSLADA": "San Ignacio",
                "ORIXE": "San Ignacio",
                "PL LEVANTE": "San Ignacio",
                "PL AITA PATXI": "San Ignacio",
                "PL CELESTINO MARIA D": "San Ignacio",
                "PINTOR ETXENAGUSIA": "San Ignacio",
                "SAN IGNACIO AUZOA": "San Ignacio",
                "CATALUNYA":"San Ignacio",
                "LARRAKOTORRE":"San Ignacio",
                "RI ELORRIETA":"San Ignacio",
                "MIKEL ZARATE":"San Ignacio",
                "PEDRO ASTIGARRAGA":"San Ignacio",
                //"":"San Ignacio",
                //"":"San Ignacio",
                //"":"San Ignacio",
                //"":"San Ignacio",
                //"":"San Ignacio",
                //"":"San Ignacio",
                //"":"San Ignacio",
                //"":"San Ignacio",
                //"":"San Ignacio",
                 
                      
                //  MATIKO 

                "URIBARRI":"Matiko",
                "TRAUKO":"Matiko",
                "URIBARRI":"Matiko",
                "SAN ROKE":"Matiko",
                "RICARDO ARREGUI 007":"Matiko",
                "HUERTAS DE LA VILLA":"Matiko",
                "CASTAÑOS":"Matiko",
                //"":"Matiko",
                //"":"Matiko",
                //"":"Matiko",
                //"":"Matiko",
                //"":"Matiko",
                //"":"Matiko",
                //"":"Matiko",
                //"":"Matiko",


                // MATIKO ALTO

                "CA LANDETA BIDEA":"Matiko Alto",
                "ABASOLO":"Matiko Alto",
                "CASTAÑOS":"Matiko Alto",
                //"":"Matiko Alto",
                //"":"Matiko Alto",
                //"":"Matiko Alto",
                //"":"Matiko Alto",
                //"":"Matiko Alto",
                //"":"Matiko Alto",
                //"":"Matiko Alto",
                


                //  BILBAO CENTRO

                "AL GREGORIO DE LA RE 012  004 IZ":"Bilbao Centro",
                "AL URQUIJO 018": "Bilbao Centro",
                "ARANE": "Bilbao Centro",
                "AUTONOMIA": "Bilbao Centro",
                "AV LAPURDI": "Bilbao Centro",
                "AV SABINO ARANA ": "Bilbao Centro",
                "BERASTEGUI": "Bilbao Centro",
                "BERTENDONA": "Bilbao Centro",
                "ESTACION DE BASURTU": "Bilbao Centro",
                "GENERAL CONCHA": "Bilbao Centro",
                "GURTUBAY": "Bilbao Centro",
                "HEROS": "Bilbao Centro",
                "HURTADO DE AMEZAGA": "Bilbao Centro",
                "IBAÑEZ DE BILBAO": "Bilbao Centro",
                "IPARRAGUIRRE": "Bilbao Centro",
                "IRALA": "Bilbao Centro",
                "JUAN AJURIAGUERRA": "Bilbao Centro",
                "LICENCIADO POZA": "Bilbao Centro",
                "LUIS BRIÑAS": "Bilbao Centro",
                "LUTXANA": "Bilbao Centro",
                "MEDINA DE POMAR": "Bilbao Centro",
                "OLITE": "Bilbao Centro",
                "PL GENERAL LATORRE": "Bilbao Centro",
                "RODRIGUEZ ARIAS":"Bilbao Centro",
                "URIZAR":"Bilbao Centro",
                "ZANKOETA":"Bilbao Centro",
                "HURTADO DE AMEZAGA":"Bilbao Centro",
                "CARDENAL GARDOQUI":"Bilbao Centro",
                "EUSKALDUNA":"Bilbao Centro",
                "ENRIQUE EGUREN":"Bilbao Centro",
                "SIMON BOLIVAR":"Bilbao Centro",
                "LEDESMA":"Bilbao Centro",
                "COSME ECHEVARRIETA":"Bilbao Centro",
                "AVILA": "Bilbao Centro",
                "GENERAL EGUIA": "Bilbao Centro",
                "MARIA DIAZ DE HARO": "Bilbao Centro",
                "LABAYRU": "Bilbao Centro",
                "AL URQUIJO": "Bilbao Centro",
                "PEREZ GALDOS": "Bilbao Centro",
                //"": "Bilbao Centro",
                //"": "Bilbao Centro",
                //"": "Bilbao Centro",
                //"": "Bilbao Centro",
                //"": "Bilbao Centro",
                            


                // BILBAO_BASURTU

                "ES MASUSTEGI":"Bilbao-Basurtu",
                "CA BASURTU-KASTREXAN":"Bilbao-Basurtu",
                "BA ALTAMIRA":"Bilbao-Basurtu",
                "LEZEAGA":"Bilbao-Basurtu",
                //"":"Bilbao-Basurtu",
                //"":"Bilbao-Basurtu",
                //"":"Bilbao-Basurtu",
                //"":"Bilbao-Basurtu",
                //"":"Bilbao-Basurtu",
                //"":"Bilbao-Basurtu",
                //"":"Bilbao-Basurtu",
                //"":"Bilbao-Basurtu",



                // KASKO VIEJO

                "ANDRA MARI": "Kasko Viejo",
                "ARTEKALE": "Kasko Viejo",
                "PL UNAMUNO": "Kasko Viejo",
                "BARRENKALE": "Kasko Viejo",
                "BARRANKALE BARRENA": "Kasko Viejo",
                "BELOSTIKALE": "Kasko Viejo",
                "CARNICERIA VIEJA": "Kasko Viejo",
                "CORREO": "Kasko Viejo",
                "CORREOS": "Kasko Viejo",
                "LA RIBERA": "Kasko Viejo",
                "MERCED": "Kasko Viejo",
                "PL ARRIAGA": "Kasko Viejo",
                "PL MIGUEL DE UNAMUNO": "Kasko Viejo",
                "PL NUEVA": "Kasko Viejo",
                "PL SANTIAGO": "Kasko Viejo",
                "PL SANTOS JUANES": "Kasko Viejo",
                "RIBERA": "Kasko Viejo",
                "RIBERA VIEJA": "Kasko Viejo",
                "SOMERA": "Kasko Viejo",
                "TENDERIA": "Kasko Viejo",
                "RONDA":"Kasko Viejo",
                "JARDINES":"Kasko Viejo",
                "ASKAO":"Kasko Viejo",
                //"":"Kasko Viejo",
                //"":"Kasko Viejo",
                //"":"Kasko Viejo",
                //"":"Kasko Viejo",
                //"":"Kasko Viejo",
                //"":"Kasko Viejo",
                //"":"Kasko Viejo",
                //"":"Kasko Viejo",
                //"":"Kasko Viejo",
                //"":"Kasko Viejo",
                //"":"Kasko Viejo",
                //"":"Kasko Viejo",
                //"":"Kasko Viejo",
            
            
                // SANTUTXU

                "ITURRIBIDE": "Santutxu",
                "OLLERIAS ALTAS": "Santutxu",
                "LUIS LUCIANO BONAPAR": "Santutxu",
                "SANTA CECILIA": "Santutxu",
                "GR SAGARMINAGA": "Santutxu",
                "SAGARMINAGA": "Santutxu",
                "MEDICO ANTONIO EGUIL": "Santutxu",
                "SANTUTXU": "Santutxu",
                "MASUSTEGI": "Santutxu",
                "PL ARQUITECTO RICARD":"Santutxu",
                "JUAN GUISASOLA": "Santutxu",
                "AV INDALECIO PRIETO": "Santutxu",
                "SANTA CLARA": "Santutxu",
                "PL LUIS ECHEVARRIA": "Santutxu",
                "BA AZURLEKU": "Santutxu",
                //"": "Santutxu",
                //"": "Santutxu",
                //"": "Santutxu",
                //"": "Santutxu",
                //"": "Santutxu",
                //"": "Santutxu",
                //"": "Santutxu",
                //"": "Santutxu",
                //"": "Santutxu",

                // SANTUTXU ALTO:

                "SAN ISIDRO":"Santutxu Alto",
                //"":"Santutxu Alto",
                //"":"Santutxu Alto",
                //"":"Santutxu Alto",
                //"":"Santutxu Alto",
                //"":"Santutxu Alto",
                //"":"Santutxu Alto",
                //"":"Santutxu Alto",
                //"":"Santutxu Alto",
                //"":"Santutxu Alto",
                //"":"Santutxu Alto",


                // SANFRA

                "SAN FRANCISCO": "SanFra",
                "HERNANI": "SanFra",
                "BILBAO LA VIEJA": "SanFra",
                "BRUNO MAURICIO ZABAL": "SanFra",
                "BAILEN": "SanFra",
                "ARECHAGA": "SanFra",
                //"": "SanFra",
                //"": "SanFra",
                //"": "SanFra",
                //"": "SanFra",
                //"": "SanFra",
                //"": "SanFra",
                //"": "SanFra",
                //"": "SanFra",

                //MIRIBILLA

                "GOIKO TORRE": "Miribilla",
                "AV SAN ADRIAN": "Miribilla",
                "JA GERNIKA LORATEGIA": "Miribilla",
                "ANGEL ORTIZ ALFAU": "Miribilla",
                "DOCTOR ESPINOSA ORIB": "Miribilla",
                //"": "Miribilla",
                //"": "Miribilla",
                //"": "Miribilla",
                //"": "Miribilla",
                //"": "Miribilla",
                //"": "Miribilla",
                //"": "Miribilla",
                //"": "Miribilla",


                // ZAMAKOLA

                "URAZURRUTIA":"Zamakola",
                "ZAMAKOLA":"Zamakola",
                //"":"Zamakola",
                //"":"Zamakola",
                //"":"Zamakola",
                //"":"Zamakola",
                //"":"Zamakola",


                // ZORROZA

                "CORDELERIA": "Zorroza",
                "CA ZORROTZA-KASTREXA": "Zorroza",
                "GR JARDIN DE ZORROTZ": "Zorroza",
                "GR IKASTALDE": "Zorroza",
                //"": "Zorroza",
                //"": "Zorroza",
                //"": "Zorroza",
                //"": "Zorroza",
                //"": "Zorroza",
                //"": "Zorroza",
                //"": "Zorroza",
                //"": "Zorroza",
                //"": "Zorroza",
                //"": "Zorroza",
                //"": "Zorroza",
                //"": "Zorroza",



                // ZURBARANBARRI

                "CA VIA VIEJA DE LEZA":"Zurbaranbarri",
                "BA ZURBARANBARRI":"Zurbaranbarri",
                //"":"Zurbaranbarri",
                //"":"Zurbaranbarri",
                //"":"Zurbaranbarri",
                //"":"Zurbaranbarri",
                //"":"Zurbaranbarri",
                //"":"Zurbaranbarri",
                //"":"Zurbaranbarri",

                // REKALDE

                "ESPERANTO": "Rekalde",
                "MATILDE ORBEGOZO": "Rekalde",
                "FILOMENA BALDEZATE": "Rekalde",
                "CA ERREKALDE-LARRASK": "Rekalde",
                "ERREKALDEBERRI": "Rekalde",
                "HIJAS DE LA CARIDAD": "Rekalde",
                "PL ERREKALDE": "Rekalde",
                "SOLLUBE": "Rekalde",
                "MONCADA": "Rekalde",
                //"": "Rekalde",
                //"": "Rekalde",
                //"": "Rekalde",
                //"": "Rekalde",
                //"": "Rekalde",
                //"": "Rekalde",
                //"": "Rekalde",
                //"": "Rekalde",
                //"": "Rekalde",
                //"": "Rekalde",
                //"": "Rekalde",
                //"": "Rekalde",
                //"": "Rekalde",
                //"": "Rekalde",
                //"": "Rekalde",


                // TXURDINAGA:

                "UGARTE":"Txurdinga",
                "ZIZERUENA":"Txurdinga",
                "GARATE":"Txurdinga",
                "AV GABRIEL ARESTI":"Txurdinga",
                "AV JESUS GALINDEZ":"Txurdinga",
                "AV PAU CASALS":"Txurdinga",
                "LARRAKOETXE":"Txurdinga",
                "TXOTENA":"Txurdinga",
                "LANGARAN":"Txurdinga",
                //"":"Txurdinga",
                //"":"Txurdinga",
                //"":"Txurdinga",
                //"":"Txurdinga",
                //"":"Txurdinga",
                
                





        };

        // Variables globales
        let processedData = [];
        const processBtn = document.getElementById('processBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const fileInput = document.getElementById('fileInput');
        const resultsDiv = document.getElementById('results');

        // Habilitar botón cuando se selecciona un archivo
        fileInput.addEventListener('change', (e) => {
            processBtn.disabled = !e.target.files.length;
        });

        // Función para asignar zona
        function asignarZona(calle) {
            if (!calle) return "";
            
            const calleUpper = calle.toString().toUpperCase().trim();
            
            // 1. Búsqueda exacta
            for (const [clave, zona] of Object.entries(zonasEstandar)) {
                if (calleUpper.includes(clave)) {
                    return zona;
                }
            }
            
            return "";
        }

        // Procesar el archivo Excel
        processBtn.addEventListener('click', async () => {
            const file = fileInput.files[0];
            if (!file) return;
            
            try {
                // Leer el archivo Excel
                const data = await file.arrayBuffer();
                const workbook = XLSX.read(data);
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                
                // Convertir a JSON
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                // Asignar zonas
                processedData = jsonData.map(row => ({
                    ...row,
                    Zona: asignarZona(row.Calle)
                }));
                
                // Mostrar estadísticas
                const totalCalles = processedData.length;
                const callesEncontradas = processedData.filter(row => row.Zona !== "").length;
                
                resultsDiv.innerHTML = `
                    <h3>Resultados del procesamiento:</h3>
                    <p>Total de calles procesadas: ${totalCalles}</p>
                    <p>Calles con zona asignada: ${callesEncontradas}</p>
                    <p>Calles no identificadas: ${totalCalles - callesEncontradas}</p>
                `;
                
                // Habilitar botón de descarga
                downloadBtn.disabled = false;
                
            } catch (error) {
                resultsDiv.innerHTML = `<p style="color: red;">Error al procesar el archivo: ${error.message}</p>`;
            }
        });

        // Descargar el resultado como Excel
        downloadBtn.addEventListener('click', () => {
            if (processedData.length === 0) return;
            
            try {
                // Crear nueva hoja de cálculo
                const newWorksheet = XLSX.utils.json_to_sheet(processedData);
                
                // Crear nuevo libro de Excel
                const newWorkbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(newWorkbook, newWorksheet, "Calles con Zonas");
                
                // Descargar el archivo
                XLSX.writeFile(newWorkbook, "calles_con_zonas.xlsx");
                
                resultsDiv.innerHTML += `<p style="color: green;">Archivo descargado con éxito!</p>`;
            } catch (error) {
                resultsDiv.innerHTML += `<p style="color: red;">Error al generar el archivo: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>